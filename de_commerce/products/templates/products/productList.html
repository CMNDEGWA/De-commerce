{% extends 'base.html' %}
{% block content %}
<h1>Product List</h1>
<form method="get" action="{% url 'products:product_list' %}">
    <input type="text" name="q" placeholder="Search products..." value="{{ request.GET.q }}">
    <select name="sort">
        <option value="name" {% if request.GET.sort == 'name' %}selected{% endif %}>Sort by Name</option>
        <option value="price" {% if request.GET.sort == 'price' %}selected{% endif %}>Sort by Price</option>
    </select>
    <button type="submit">Apply</button>
</form>
<form method="get">
    <select name="category" onchange="this.form.submit()">
        <option value="">All Categories</option>
        {% for category in categories %}
            <option value="{{ category.id }}" {% if request.GET.category|default:'' == category.id|stringformat:'s' %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
    </select>
</form>
<ul>
    {% for product in products %}
        <li>
            <div class="product">
                {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
                {% endif %}
                <h3>{{ product.name }}</h3>
                <p>{{ product.description }}</p>
                <p>Price: ${{ product.price }}</p>
                <a href="{% url 'products:product_detail' product.pk %}">View Details</a>
            </div>
        </li>
    {% empty %}
        <li>No products found.</li>
    {% endfor %}
</ul>
<!-- Display pagination controls -->
<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}&q={{ request.GET.q }}&sort={{ request.GET.sort }}">Previous</a>
    {% endif %}

    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&q={{ request.GET.q }}&sort={{ request.GET.sort }}">Next</a>
    {% endif %}
</div>
<a href="{% url 'products:cart_detail' %}">View Cart</a>
{% endblock %}
